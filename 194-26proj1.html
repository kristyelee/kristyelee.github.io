<!DOCTYPE html>
<!--
    Plain-Academic by Vasilios Mavroudis
    Released under the  Simplified BSD License/FreeBSD (2-clause) License.
    https://github.com/mavroudisv/plain-academic
-->

<html lang="en">


    <head>
        <title>CS 194-26 Project 1: Kristy Lee</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"> -->
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
        <!-- <link href='https://fonts.googleapis.com/css?family=Oswald:700' rel='stylesheet' type='text/css'>-->
    </head>
    
<body>
    <!-- Page Content -->
    <div class="container">
        <div class="row">
            <!-- Entries Column -->
            <div class="col-md-8" style="min-height: 100vh; height: auto;">
                <!-- <img class="img-responsive" src="banner.jpg" alt=""><br> -->
                <h1>CS 194-26 Project 1 Report</h1>
                <div class="col-md-4">
                    <h2><p>Kristy Lee</p></h2>
                    <p><b>kristylee@berkeley.edu</b></p>
                    <p>
                        This project involves working on code that experiments with filtering images, extracting low and high frequencies from images, and blending different images together seamlessly.
                    </p>
                </div>
            <div style="margin-top:3%; text-align:left;">

                    <p>
                        The project involves working on code that can turn a digitized 3-part Prokudin-Gorskii glass plate image into a color image through extracting, overlaying, and aligning the B, G, and R filters of the glass plate image.
                    </p>

                    <p>
                        To align the images, I've worked on two different search algorithms: first, using exhaustive search alone, and second, using an image pyramid search procedure.
                    </p>

                    <h3>Exhaustive Search</h3>
                    <p>
                        Exhaustive search involves searching for the best alignment through examining possible displacements [-15, 15] in both the x and y directions when performing the overlaying for producing the color image.
                        For each image, I divide the image into their R, G, and B parts and overlay the R and G images onto B. I experimented with both the sum of squared distances (SSD) and normalized cross-correlation (NCC) metrics between the two images to find the best alignment, and found that SSD provided a more reliable alignment metric.
                        Before beginning the test for finding the best alignment, I make copies of the two images and subtract 25 pixels from the borders of both images to produce the images I would test different displacements on to find the best displacement, since I found that including the borders when testing displacements tended to hurt my results and using internal pixels is better for testing.
                        For the best displacement, I chose the x-y displacement that resulted in the minimum SSD of the overlapped images, and then proceeded to overlay the image accordingly.
                        Once I have the best displacement, I return to using the originally-sized image I was trying to overlay on top of the B image to perform the next steps.
                        "np.roll" proved to be a good command to use that would overlap the image properly on top of the B image.
                        After rolling to align the overlaid image using "np.roll," I zero out the pixels that are incorrectly placed at the other side of the image as a result of the rolling.
                    </p>
                    <p>
                        The exhaustive search method was pretty straightforward to implement, and I didn't have much issue. The algorithm didn't fail to align any image: I've produced beautifully aligned images using this method, and have included my results below along with the recorded displacement vectors:
                    </p>

                    <h4>Cathedral</h4>
                    <p>Green displacement vector: [x=2, y=5], Red displacement vector: [x=3, y=12] </p>
                    <img src="images_1/cathedral.jpg" />
                    <p>cathedral.jpg</p>

                    <h4>Monastery</h4>
                    <p>Green displacement vector: [x=2, y=-3], Red displacement vector: [x=2, y=3] </p>
                    <img src="images_1/monastery.jpg" />
                    <p>monastery.jpg</p>

                    <h4>Tobolsk</h4>
                    <p>Green displacement vector: [x=3, y=3], Red displacement vector: [x=3, y=6] </p>
                    <img src="images_1/tobolsk.jpg" />
                    <p>tobolsk.jpg</p>

                    <h3>Image Pyramid</h3>
                    <p>
                        Exhaustive search proves to be effective on the images above. However, with the larger, .tif images, exhaustive search becomes a slow process, so we look at producing the color image using an image pyramid search procedure. The image pyramid search procedure proceeds in the following way:
                        First, generate a pyramid of 6 images (where the bottom level corresponds to the originally-sized image) using the function skimage's rescale function, using a scale factor of 3/4 at each level. Then, starting at the top level (the lowest resolution image), run exhaustive search to explore a displacement window of [-15, 14] in the x and y directions, and then find the optimal offsets for the x and y directions.
                        Then, multiply the offsets by the scaling factor of 4/3, the inverse of the previous scale factor, and then repeat the exhaustive search procedure in the next lowest resolution image in the image pyramid, searching a smaller window of [-10+offset, 10+offset], where offset is the offset passed to the current pyramid level, for the respective x and y directions.
                        Then, find the level x and y offsets (in the range [-10, 10]) for that level, and add those offsets to the corresponding x and y offsets from the previous level that were passed to the current level (to get a number in the range [-10+offset, 10+offset] for x or y direction), and multiply each new offset by the scale factor 4/3.
                        At the last level of the pyramid (the original image), once exhaustive search finds the best x and y offsets, the offsets are added to the corresponding best offset from the previous level passed to the current level, and the best offsets are found after that. Then, the offsets are used to overlay either G or R images onto the B image to produce the final color image.
                    </p>

                    <h4>Church</h4>
                    <p>Green displacement vector: [x=-5, y=25], Red displacement vector: [x=-6, y=59] </p>
                    <img src="images_1/church.jpg" style="width:363px;height:321px;"/>
                    <p>church.jpg</p>

                    <h4>Emir</h4>
                    <p>Green displacement vector: [x=9, y=46], Red displacement vector: [x=17, y=107] </p>
                    <img src="images_1/emir.jpg" style="width:370px;height:322px;"/>
                    <p>emir.jpg</p>

                    <h4>Harvesters</h4>
                    <p>Green displacement vector: [x=10, y=59], Red displacement vector: [x=7, y=129] </p>
                    <img src="images_1/harvesters.jpg" style="width:369px;height:322px;"/>
                    <p>harvesters.jpg</p>

                    <h4>Icon</h4>
                    <p>Green displacement vector: [x=16, y=42], Red displacement vector: [x=22, y=92] </p>
                    <img src="images_1/icon.jpg" style="width:375px;height:326px;"/>
                    <p>icon.jpg</p>

                    <h4>Lady</h4>
                    <p>Green displacement vector: [x=-7, y=66], Red displacement vector: [x=-17, y=115] </p>
                    <img src="images_1/lady.jpg" style="width:376px;height:322px;"/>
                    <p>lady.jpg</p>

                    <h4>Melons</h4>
                    <p>Blue displacement vector: [x=-4, y=-84], Red displacement vector: [x=3, y=95] </p>
                    <img src="images_1/melons.jpg" style="width:377px;height:325px;"/>
                    <p>melons.jpg</p>

                    <h4>Onion Church</h4>
                    <p>Green displacement vector: [x=20, y=52], Red displacement vector: [x=35, y=107] </p>
                    <img src="images_1/onion_church.jpg" style="width:379px;height:322px;"/>
                    <p>onion_church.jpg</p>

                    <h4>Self Portrait</h4>
                    <p>Blue displacement vector: [x=0, y=-77], Red displacement vector: [x=7, y=98] </p>
                    <img src="images_1/self_portrait.jpg" style="width:381px;height:326px;"/>
                    <p>self_portrait.jpg</p>

                    <h4>Three Generations</h4>
                    <p>Green displacement vector: [x=5, y=53], Red displacement vector: [x=6, y=112] </p>
                    <img src="images_1/three_generations.jpg" style="width:372px;height:322px;"/>
                    <p>three_generations.jpg</p>

                    <h4>Train</h4>
                    <p>Blue displacement vector: [x=1, y=-45], Red displacement vector: [x=24, y=43] </p>
                    <img src="images_1/train.jpg" style="width:375px;height:324px;"/>
                    <p>train.jpg</p>

                    <h4>Workshop</h4>
                    <p>Green displacement vector: [x=-4, y=54], Red displacement vector: [x=-14, y=104] </p>
                    <img src="images_1/workshop.jpg" style="width:375px;height:322px;"/>
                    <p>workshop.jpg</p>

                    <h3>Other Examples</h3>
                    <p>
                        Here are a few other examples I've performed my (exhaustive search) algorithm on.
                    </p>

                    <h4>Aleksandrovskii mount</h4>
                    <p>Green displacement vector: [x=1, y=2], Red displacement vector: [x=1, y=5] </p>
                    <img src="images_1/aleksandrovskii_mount.jpg" />
                    <p>aleksandrovskii_mount.jpg</p>

                    <h4>Church of Saint John the Theologian, on Ishna, three versts from Rostov</h4>
                    <p>Green displacement vector: [x=-1, y=4], Red displacement vector: [x=-3, y=11] </p>
                    <img src="images_1/church_saint_john_rostov.jpg" />
                    <p>church_saint_john_rostov.jpg</p>

                    <h4>Church of Saint John the Theologian, on Ishna. View from the South</h4>
                    <p>Green displacement vector: [x=2, y=6], Red displacement vector: [x=2, y=13] </p>
                    <img src="images_1/church_saint_john_south.jpg" />
                    <p>church_saint_john_south.jpg</p>

                    <h3>Concerns of Alignment/Other Challenges</h3>
                    <p>
                        Exhaustive search aligned every image perfectly. However, image pyramid did not align all images perfectly. The Emir, harvesters, and lady images are some of the images that are slightly miscolored (but not noticeably miscolored) by the image pyramid search procedure. The train, melons, and self portrait images were noticeably misaligned, though, when I initially aligned G and R over B. When I aligned B and R over G for those images, however, the results turned out to look better. See beneath for the differences.
                    </p>
                    <h4>Bad Melons</h4>
                    <p>Green displacement vector: [x=4, y=84], Red displacement vector: [x=-2, y=144] </p>
                    <img src="images_1/melons_bad.jpg" style="width:375px;height:324px;"/>
                    <p>melons_bad.jpg</p>
                    <h4>Good Melons</h4>
                    <p>Blue displacement vector: [x=-4, y=-84], Red displacement vector: [x=3, y=95] </p>
                    <img src="images_1/melons.jpg" style="width:375px;height:324px;"/>
                    <p>melons.jpg</p>

                    <h4>Bad Self Portrait</h4>
                    <p>Green displacement vector: [x=-1, y=76], Red displacement vector: [x=-4, y=144] </p>
                    <img src="images_1/self_portrait_bad.jpg" style="width:375px;height:324px;"/>
                    <p>self_portrait_bad.jpg</p>
                    <h4>Good Self Portrait</h4>
                    <p>Blue displacement vector: [x=0, y=-77], Red displacement vector: [x=7, y=98] </p>
                    <img src="images_1/self_portrait.jpg" style="width:381px;height:326px;"/>
                    <p>self_portrait.jpg</p>

                    <h4>Bad Train</h4>
                    <p>Green displacement vector: [x=-2, y=45], Red displacement vector: [x=-1, y=143] </p>
                    <img src="images_1/train_bad.jpg" style="width:375px;height:324px;"/>
                    <p>train_bad.jpg</p>
                    <h4>Good Train</h4>
                    <p>Blue displacement vector: [x=1, y=-45], Red displacement vector: [x=24, y=43] </p>
                    <img src="images_1/train.jpg" style="width:375px;height:324px;"/>
                    <p>train.jpg</p>

                    <p>
                        Switching to aligning B and R over G for the other slightly miscolored images mentioned did not help as much. As for the other slightly miscolored images, I think the reason they were slightly miscolored is because of imperfections in my scale factor and corresponding search window with respect to the currently tracked best displacements/offsets accumulated from previous levels, and to resolve these issues I tried to fine tune the scale factor, displacement search window, and tried to overlay B and R over G for the best results, but all of those didn't work for me. Though the slight discoloration might not be even an issue with optimal alignment and maybe could be the best possible.
                    </p>
                    <p>
                        This project was challenging for me because it was my first time working with images in Python and learning how to displace images to find the best alignment. I also thought that implementing the image pyramid was hard to understand at first but eventually made some sense to me. With this project, I've grown in skills to process images in Python and write code that helps me visualize certain operations on 2D images.
                    </p>

                    <h3>Summary</h3>
                    <p>
                        I learned about converting a 3-part Prokudin-Gorskii glass plate image to a color image, general knowledge of RGB channels, image displacement, exhaustive search procedure, and image pyramid search procedure.
                    </p>

                    <!-- <h4>Aleksandrovskii mount</h4>
                    <p>Green displacement vector: [x=1, y=2], Red displacement vector: [x=1, y=5] </p>
                    <img src="images/aleksandrovskii_mount.jpg" />
                    <p>aleksandrovskii_mount.jpg</p>

                    <h4>Monastery</h4>
                    <p>Green displacement vector: [x=-1, y=4], Red displacement vector: [x=-3, y=11] </p>
                    <img src="images/church_saint_john_rostov.jpg" />
                    <p>church_saint_john_rostov.jpg</p>

                    <h4>Tobolsk</h4>
                    <p>Green displacement vector: [x=2, y=6], Red displacement vector: [x=2, y=13] </p>
                    <img src="images/church_saint_john_south.jpg" />
                    <p>church_saint_john_south.jpg</p> -->

                </div>

            </div>

          
            <!-- Links on the Sidebar -->
            <!--
            <div class="col-md-4" style="margin-top:2%">
                <dd><a href="#">Google Scholar</a></dd>
                <dd><a href="#">Twitter</a></dd>
                <dd><a href="#">LinkedIn</a></dd>
            </div>
            -->

        </div>

    </div>
    <!-- /.container -->



    <!-- Other people may like it too! -->
    <!-- <a style="color:#868d96;font-size:0.9em; float:right;" href="https://github.com/mavroudisv/plain-academic" target="_blank">Design courtesy of Vasilios Mavroudis: Plain Academic. &emsp;</a><br> -->

</body>


</html>
