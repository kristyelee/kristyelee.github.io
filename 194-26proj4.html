<!DOCTYPE html>
<!--
    Plain-Academic by Vasilios Mavroudis
    Released under the  Simplified BSD License/FreeBSD (2-clause) License.
    https://github.com/mavroudisv/plain-academic
-->

<html lang="en">

<head>
    <title>CS 194-26 Project 4: Kristy Lee</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->
    <!-- <link href='https://fonts.googleapis.com/css?family=Oswald:700' rel='stylesheet' type='text/css'>-->
</head>


<body>
    <!-- Page Content -->
    <div class="container">
        <div class="row">
            <!-- Entries Column -->
            <div class="col-md-8" style="min-height: 100vh; height: auto;">
                <!-- <img class="img-responsive" src="banner.jpg" alt=""><br> -->
                <h1>CS 194-26 Project 4A Report: Image Warping and Mosaicing</h1>
                <div class="col-md-4">
                    <h2><p>Kristy Lee</p></h2>
                    <p><b>kristylee@berkeley.edu</b></p>
                    <p>
                        This project involves working on code to warp images into a mosaic using transformations from a homography matrix. I take multiple photographs from the same point of view but with different view directions/overlapping fields of view, and use those to create a mosaic. I also learned about image rectification, or warping an image so that certain lines are aligned/straightened. 
                    </p>
                </div>
                <div style="margin-top:3%; text-align:left;">
                    <h2>Shoot the Pictures</h2>
                    <p>
                        I use my iPhone camera with general settings and exposure and focus locking (AE/AF) to take a few photos. Here are the images I've taken:
                    </p>
                    <table align="center">
                        <tr>
                            <td>
                                <img src="images_4/Whiteboard1.jpeg" alt="Whiteboard1" style="width:504px;height:378px;" />
                                <figcaption align="center">Whiteboard Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Whiteboard2.jpeg" alt="Whiteboard2" style="width:504px;height:378px;" />
                                <figcaption align="center">Whiteboard Right</figcaption> 
                            </td>
                        </tr>


                        <tr>
                            <td>
                                <img src="images_4/Stand1.jpeg" alt="Stands1" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Stand2.jpeg" alt="Stands2" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Right</figcaption> 
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <img src="images_4/Door1.jpeg" alt="Door1" style="width:400px;height:378px;" />
                                <figcaption align="center">Door Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Door2.jpeg" alt="Door2" style="width:504px;height:378px;" />
                                <figcaption align="center">Door Right</figcaption> 
                            </td>
                            </tr>

                        <tr>
                            <td>
                                <img src="images_4/Vendor1.jpg" alt="Vendor1" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Vendor2.jpg" alt="Vendor2" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Center</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Vendor3.jpg" alt="Vendor3" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Right</figcaption> 
                            </td>
                        </tr>

                        
                       
                    </table>
                    <h2>Recover Homographies</h2>
                    <p>
                        In this section, I compute the homography matrix which will transform points from one image to another image. The goal of the homographic matrix is to map each set of points p = (x,y) from an original image to p' = (x',y'), a set of points in the target image. H is defined as
                        \[H = \begin{bmatrix} a & b & c \\ d & e & f \\ g & h & i \end{bmatrix} \]
                        For this assignment, the scale factor i is equal to 1 so that the homography matrix has 8 degrees of freedom. Let \( \textbf{p'} = \begin{bmatrix} wx' \\ wy' \\ w \end{bmatrix} \), \( \textbf{p} = \begin{bmatrix} x \\ y \\ 1 \end{bmatrix} \). 
                        and the mapping from <b>p</b> to <b>p'</b> is defined as 
                        \[\textbf{p'} = H\textbf{p}\]
                        The following implies that \(x' = ax + by + c - x'x - x'y\), and \(y' = ax + by + c - y'x - y'y\).
                        In H, there are 8 unknown variables. To solve for the 8 unknowns, I need 8 equations, which can be provided if I used at least 4 corresponding points in each image. Realistically, though, using 4 corresponding points doesn't make the homographic transformation prone to noise/error. So it is more typical to select multiple points, and solve the following system of equations using least squares. 
                        \[\begin{bmatrix}
                        x_{1} & y_{1} & 1 & 0 & 0 & 0 & -x_{1}'*x_{1} & -x_{1}'*y_{1}\\
                        0 & 0 & 0 & x_{1} & y_{1} & 1 & -y_{1}'*x_{1} & -y_{1}'*y_{1}\\
                        x_{2} & y_{2} & 1 & 0 & 0 & 0 & -x_{2}'*x_{2} & -x_{2}'*y_{2}\\
                        0 & 0 & 0 & x_{2} & y_{2} & 1 & -y_{2}'*x_{2} & -y_{2}'*y_{2}\\
                        x_{3} & y_{3} & 1 & 0 & 0 & 0 & -x_{3}'*x_{3} & -x_{3}'*y_{3}\\
                        0 & 0 & 0 & x_{3} & y_{3} & 1 & -y_{3}'*x_{3} & -y_{3}'*y_{3}\\
                        x_{4} & y_{4} & 1 & 0 & 0 & 0 & -x_{4}'*x_{4} & -x_{4}'*y_{4}\\
                        0 & 0 & 0 & x_{4} & y_{4} & 1 & -y_{4}'*x_{4} & -y_{4}'*y_{4} \\
                        ..... \\
                        \end{bmatrix}
                        \begin{bmatrix}
                        a\\
                        b\\
                        c\\
                        d\\
                        e\\
                        f\\
                        g\\
                        h
                        \end{bmatrix}
                        =
                        i * \begin{bmatrix}
                        x{1}'\\
                        y{1}'\\
                        x{2}'\\
                        y{2}'\\
                        x{3}'\\
                        y{3}'\\
                        x{4}'\\
                        y{4}' \\
                        ...
                        \end{bmatrix} \text{, } i = 1
                        \] 
                        
                        In my code, I defined <code>H = computeH(im1_pts, im2_pts)</code> to do the computation where <code>im1_pts</code> are the source points and <code>im2_pts</code> are the destination points. 
                        If \[A = \begin{bmatrix}
                        x_{1} & y_{1} & 1 & 0 & 0 & 0 & -x_{1}'*x_{1} & -x_{1}'*y_{1}\\
                        0 & 0 & 0 & x_{1} & y_{1} & 1 & -y_{1}'*x_{1} & -y_{1}'*y_{1}\\
                        x_{2} & y_{2} & 1 & 0 & 0 & 0 & -x_{2}'*x_{2} & -x_{2}'*y_{2}\\
                        0 & 0 & 0 & x_{2} & y_{2} & 1 & -y_{2}'*x_{2} & -y_{2}'*y_{2}\\
                        x_{3} & y_{3} & 1 & 0 & 0 & 0 & -x_{3}'*x_{3} & -x_{3}'*y_{3}\\
                        0 & 0 & 0 & x_{3} & y_{3} & 1 & -y_{3}'*x_{3} & -y_{3}'*y_{3}\\
                        x_{4} & y_{4} & 1 & 0 & 0 & 0 & -x_{4}'*x_{4} & -x_{4}'*y_{4}\\
                        0 & 0 & 0 & x_{4} & y_{4} & 1 & -y_{4}'*x_{4} & -y_{4}'*y_{4} \\
                        ..... \\ \end{bmatrix} , b = \begin{bmatrix}
                        x{1}'\\
                        y{1}'\\
                        x{2}'\\
                        y{2}'\\
                        x{3}'\\
                        y{3}'\\
                        x{4}'\\
                        y{4}' \\
                        ...
                        \end{bmatrix} \\
                        \] 
                        I solve for \[h = \begin{bmatrix}
                        a\\
                        b\\
                        c\\
                        d\\
                        e\\
                        f\\
                        g\\
                        h
                        \end{bmatrix}\] using <code>np.linalg.lstsq(A,b)</code>, and construct \(H\).
                    </p>

                    <h2>Warp the Images [2 Examples of Rectified Images]</h2>
                    <p>
                        Now knowing how to compute the homograpic matrix from the previous part, I can now warp images using a specifically computed homographic matrix between the images to perform a forward warp. In my code, I defined <code>imwarp = warpImage(im, dest_im, H)</code> to perform the warp (dest_im is the image with the coordinate system to map the source image to. It has dimensions that may be padded relative to the source image im). 
                        I compute the bounding box region/dimensions of the warped image, adjust the homography matrix accordingly, and then proceeded with a forward warping method: compute the points corresponding to the source points by using the transformation homography matrix H. Use <code>cv2.remap(src, map1=warped_pts, map2 = None, interpolation=cv2.INTER_CUBIC)</code> to map the pixels of the source image to the corresponding positions of the points defined by warped_pts. 
                        After I've completed the warp code, I proceeded to work on image rectification for some images with planar surfaces: I warp those images to images with frontal-parallel plane (i.e. aligned horizontally and/or vertically). For the first example, I see four corners of a tile floor that surround the alcohol bottle. With the tile being square, I used four points corresponding to the corners of the tile, and calculated a homographic mapping to a square defined arbitrarily (I used coordinates \([[300, 1500], [2000, 1500], [300, 2800], [2000, 2800]]\) which were approximately similar to the coordinates of the tile in the unwarped image, \([[300.590909090909, 1694.772727272727], [1958.7727272727275, 1192.954545454545], [147.86363636363603, 3211.1363636363635], [2896.954545454546, 2349.3181818181815]]\)). 
                        I use the book front cover in the second page and map the corners to an arbitrary vertical rectangle shape's corners. Here are the corresponding images:
                    </p>

                    <table align="center">
                        <tr>
                            <td>
                                <img src="images_4/Alcohol1.jpeg" alt="Alcohol1" style="width:378px;height:504px;" />
                                <figcaption align="center">Alcohol</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im5_1_correspondence_points.png" alt="Alcohol" style="width:400px;height:300px;" />
                                <figcaption align="center">Alcohol Tile Corner Pts</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im5_2_correspondence_points.png" alt="Alcohol" style="width:400px;height:300px;" />
                                <figcaption align="center">Alcohol Square Pts</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/AlcoholWarped.png" alt="Warped Alcohol" style="width:300px;height:662px;"/>
                                <figcaption align="center">Warped Alcohol Image (by square tile)</figcaption> 
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <img src="images_4/OSBook.jpeg" alt="OS Book" style="width:378px;height:504px;" />
                                <figcaption align="center">OS Book</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im6_1_correspondence_points.png" alt="OS Book" style="width:400px;height:300px;" />
                                <figcaption align="center">OS Book Corner Pts</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im6_2_correspondence_points.png" alt="OS Book" style="width:400px;height:300px;" />
                                <figcaption align="center">OS Book Rectangle Pts</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/OSBookWarped.png" alt="Warped OS Book (by rectangular shape)"style="width:350px;height:342px;"/>
                                <figcaption align="center">Warped OS Book (by rectangular shape)</figcaption> 
                            </td>
                            
                        </tr>

                        </table>

                    <h2>Blend the Images into a Mosaic</h2>
                    <p>
                        Now, I blend the images into a mosaic through weighted averaging in code. In most cases, I leave the right (source2) image constant while warping the left (source1) image to its projection. For the mosaic with multiple images, I choose one base image, compute 2 series of images warped consecutively to the base image (from both directions), and then stitched the images together. Thus, my code supports the stitching of images together to create a mosaic. Here are some examples of photos:
                    </p>


                    <table align="center">
                        <tr>
                            <td>
                                <img src="images_4/Whiteboard1.jpeg" alt="Whiteboard1" style="width:450px;height:338px;" />
                                <figcaption align="center">Whiteboard Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Whiteboard2.jpeg" alt="Whiteboard2" style="width:450px;height:338px;" />
                                <figcaption align="center">Whiteboard Right</figcaption> 
                            </td>
                            </tr>
                            <tr>
                            <td>
                                <img src="images_4/imwarped_2.png" alt="Whiteboard Left Warped" style="width:450px;height: 396px;" />
                                <figcaption align="center">Whiteboard Left Warped</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Whiteboard2.jpeg" alt="Whiteboard Right" style="width:450px;height:338px;" />
                                <figcaption align="center">Whiteboard Right</figcaption> 
                            </td>
                            </tr>
                            <tr>
                            <td>
                                <img src="images_4/im2_1_correspondence_points.png" alt="Bookshelf3" style="width:400px;height:300px;" />
                                <figcaption align="center">Whiteboard Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im2_2_correspondence_points.png" alt="Bookshelf3" style="width:400px;height:300px;" />
                                <figcaption align="center">Whiteboard Right</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/blended_2.png" alt="Blended Whiteboard" style="width:500px;height:356px;" />
                                <figcaption align="center">Whiteboard Mosaic</figcaption> 
                            </td>
                        </tr>
                
                        <tr>
                            <td>
                                <img src="images_4/Stand1.jpeg" alt="Stands1" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Stand2.jpeg" alt="Stands2" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Right</figcaption> 
                            </td>
                        </tr>
                            <tr>
                            <td>
                                <img src="images_4/imwarped_1.png" alt="Stands Left Warped" style="width:400px;height:313px;" />
                                <figcaption align="center">Stands Left Warped</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Stand2.jpeg" alt="Stands Right" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Right</figcaption> 
                            </td>
                            </tr>
                            <tr>
                            <td>
                                <img src="images_4/im1_1_correspondence_points.png" alt="Stands3" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im1_2_correspondence_points.png" alt="Stands3" style="width:400px;height:300px;" />
                                <figcaption align="center">Stands Center</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/blended_1.png" alt="Blended Stands" style="width:600px;height:342px;" />
                                <figcaption align="center">Stands Mosaic</figcaption> 
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <img src="images_4/Door1.jpeg" alt="Door1" style="width:504px;height:360px;" />
                                <figcaption align="center">Door Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Door2.jpeg" alt="Door2" style="width:504px;height:360px;" />
                                <figcaption align="center">Door Right</figcaption> 
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <img src="images_4/imwarped_3.png" alt="Door Left Warped" style="width:504px;height:431px;" />
                                <figcaption align="center">Door Left Warped</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Door2.jpeg" alt="Door2" style="width:504px;height:360px;" />
                                <figcaption align="center">Door Right</figcaption> 
                            </td>

                        </tr>
                            <tr>

                            </tr>
                            <td>
                                <img src="images_4/im3_1_correspondence_points.png" alt="Vendor3" style="width:400px;height:300px;" />
                                <figcaption align="center">Door Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im3_2_correspondence_points.png" alt="Vendor3" style="width:400px;height:300px;" />
                                <figcaption align="center">Door Right</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/blended_3.png" alt="Door Mosaic" style="width:600px;height:382px;" />
                                <figcaption align="center">Door Mosaic</figcaption> 
                            </td>
                        </tr>

                        <tr>
                            <td>
                                <img src="images_4/Vendor1.jpg" alt="Vendor1" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Vendor2.jpg" alt="Vendor2" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Center (Base)</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Vendor3.jpg" alt="Vendor3" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Right</figcaption> 
                            </td>
                            </tr><tr>
                            <td>
                                <img src="images_4/imwarped_4_1.png" alt="Vendor3" style="width:450px;height:356px;" />
                                <figcaption align="center">Vendor Left Warped</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/Vendor2.jpg" alt="Vendor2" style="width:504px;height:378px;" />
                                <figcaption align="center">Vendor Center (Base)</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/imwarped_4_2.png" alt="Vendor3" style="width:450px;height:288px;" />
                                <figcaption align="center">Vendor Right Warped</figcaption> 
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <img src="images_4/im4_1_correspondence_points.png" alt="Vendor3" style="width:400px;height:300px;" />
                                <figcaption align="center">Vendor Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im4_2_correspondence_points.png" alt="Vendor3" style="width:400px;height:300px;" />
                                <figcaption align="center">Vendor Center (Base)</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/im4_3_correspondence_points.png" alt="Vendor3" style="width:400px;height:300px;" />
                                <figcaption align="center">Vendor Right</figcaption> 
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <img src="images_4/blended_4_1.png" alt="Vendor3" style="width:600px;height:380px;" />
                                <figcaption align="center">Vendor Mosaic Left</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/blended_4_2.png" alt="Vendor3" style="width:600px;height:326px;" />
                                <figcaption align="center">Vendor Mosaic Right</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/blended_4.png" alt="Vendor3" style="width:600px;height:326px;" />
                                <figcaption align="center">Vendor Mosaic</figcaption> 
                            </td>
                        </tr>

                    </table>
                   
                    

                    <h3>What I Learned</h3>
                    <p>
                        I thought that the coolest thing I learned when doing this project part is creating warps/transformations for projecting source images through using the homographic matrix computed using a system of equations. Creating the image mosaic and stitching two photos (that capture the same view but are taken in different directions) into the image mosaic through using the transformation from the homography turned out to be a major accomplishment that I enjoy from the project. 
                    </p>

                    <h3>Acknowledgements</h3>
                    <ul>
                        <li>
                            <a href="https://inst.eecs.berkeley.edu/~cs194-26/fa21/hw/proj4/partA.html">CS194-26 Project 4A Description</a> 
                        </li>
                        <li>
                            I've taken my own photographs for the mosaic / image rectification using iPhone camera. The images are shown above in the website, and also are included in my submission. 
                        </li>
                    </ul>
                </div>


                <h1>CS 194-26 Project 4B Report: Feature Matching for Autostitching</h1>
                <div class="col-md-4">
                    <h2><p>Kristy Lee</p></h2>
                    <p><b>kristylee@berkeley.edu</b></p>
                    <p>
                        For this portion of the project, I worked on Python code that would automatically stitch images together into a mosaic through a process of identifying harris corners for feature points, determining feature matches, and using the RANSAC loop to find a set of inlier correspondence points that would be used to compute a homography matrix for the image transformation. 
                    </p>
                </div>
                <div style="margin-top:3%; text-align:left;">
                    <h2>Harris Interest Point Detector (Section 2)</h2>
                    <p>
                        For this section, I use the starter code <code>harris.py</code> to obtain the functions <code>get_harris_corners</code> for computing the harris corner points and the corresponding values for the harris corner strength. The Harris matrix for (x,y) is computed using an outer product of gradients, shown below:
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/HarrisMatrixEquation.png" alt="HarrisMatrix" />
                                    <figcaption align="center">Harris Matrix Equation</figcaption> 
                                </td>
                            </tr>
                        </table>
                        and the corner strength \(f_{HM}\) returned for a given point (x,y) is the determinent of the Harris matrix divided by the trace of the Harris matrix. 
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/CornerFunction.png" alt="CornerFunction" />
                                    <figcaption align="center">Corner Strength Function Equation</figcaption> 
                                </td>
                            </tr>
                        </table>
                        The interest points are obtained by examining the point where the corner strength \(f_{HM}\) is a local maximum in a 3x3 region. Here is an example image for which I computed Harris corner points/interest points for:
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/corner_features_1_1.png" alt="Whiteboard1" style="width:400px;height:300px;" />
                                    <figcaption align="center">Stands Left Corner Features</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/corner_features_1_2.png" alt="Whiteboard2" style="width:400px;height:300px;" />
                                    <figcaption align="center">Stands Right Corner Features</figcaption> 
                                </td>
                            </tr>
                        </table>
                    </p>
                    <h2>Implementing Adaptive Non-Maximal Suppression (Section 3)</h2>
                    <p>
                        Matching interest points between images costs a lot of time, so thus in this section we implement adaptive non-maximal suppression method to filter the amount of interest points we consider. We compute the minimum suppression radius \(r_i\) for each interest point \(i\) by considering all other interest points \(j \neq i\) and finding the interest point \(j \neq i\) that provides the minimum value \(r_i\) through the following equation:
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/r_i.png" alt="Whiteboard1"/>
                                    <figcaption align="center">Minimum Suppression Radius Equation</figcaption> 
                                </td>
                            </tr>
                        </table>

                        Here, we use the corner strength function and a constant called \(c_{\text{robust}}\), set to 0.9, as an condition before taking the distance between the points. I have the list of points for an image sorted in decreasing order of corner strength. Once I find \(r_i\) for all interest points, I keep 500 interest points that yield the largest radii. I perform this process on the images individually. Here are my resulting photos with the interest points filtered by ANMS:
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/anms_1_1.png" alt="Whiteboard1" style="width:400px;height:300px;" />
                                    <figcaption align="center">Stands Left Interest Points(ANMS)</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/anms_1_2.png" alt="Whiteboard2" style="width:400px;height:300px;" />
                                    <figcaption align="center">Stands Right Interest Points(ANMS)</figcaption> 
                                </td>
                            </tr>
                        </table>
                    
                    
                    </p>

                    <h2>Implementing Feature Descriptor Extraction (Section 4)</h2>
                    <p>For this section, for a given image I take each interest point's coordinate (x,y), obtain a 40 x 40 region of the image around the point by taking <code>patch = im[y-20:y+20, x-20:x+20]</code>, normalize the patch such that the entries of the patch have mean 0 and standard deviation 1, and then resizing the 40 x 40 patch to an 8 x 8 patch using <code>skimage.transform.resize</code>. I perform the operation on the filtered interest points for both images. Here are some example feature descriptors: </p>
                       
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/feature_descriptor_im1_1_1.png" alt="Whiteboard1" style="width:400px;height:300px;" />
                                    <figcaption align="center">Feature Descriptor Stands 1 Example 1</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/feature_descriptor_im1_1_2.png" alt="Whiteboard2" style="width:400px;height:300px;"/>
                                    <figcaption align="center">Feature Descriptor Stands 1 Example 2</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/feature_descriptor_im1_1_3.png" alt="Whiteboard2" style="width:400px;height:300px;"/>
                                    <figcaption align="center">Feature Descriptor Stands 1 Example 3</figcaption> 
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <img src="images_4/feature_descriptor_im1_2_1.png" alt="Whiteboard1" style="width:400px;height:300px;" />
                                    <figcaption align="center">Feature Descriptor Stands 2 Example 1</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/feature_descriptor_im1_2_2.png" alt="Whiteboard2" style="width:400px;height:300px;"/>
                                    <figcaption align="center">Feature Descriptor Stands 2 Example 2</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/feature_descriptor_im1_2_3.png" alt="Whiteboard2" style="width:400px;height:300px;"/>
                                    <figcaption align="center">Feature Descriptor Stands 2 Example 3</figcaption> 
                                </td>
                            </tr>
                        </table>
                    
                    
                    </p>

                    <h2>Implementing Feature Matching(Section 5)</h2>
                    <p>Here, I identify good pairs of features here that closely correspond to each other. For each interest point (x,y) of a fixed (anchor) image, I iterate through all of the other image's interest points (x',y'), compute the SSD between both interest points' feature descriptors (<code>np.sum((fd1-fd2)**2)</code>), and store the information into NN[(x,y)]'s list by appending (x',y',SSD) to the list. Then, I sort the NN[(x,y)] list by SSD, and then identify (x,y)'s 1-NN and 2-NN. If 1-NN's SSD/2-NN's SSD \(<\) threshold (which I defined as 0.6), then I would keep (x,y) and 1-NN's (x',y') in the list of pairs of potential correspondence points. I loop through each (x,y) repeating the aforementioned process to get a complete list of kept interest points in both images. After I finish identifying the kept interest points, I display the interest points in the images as shown below:</p>
                       
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/keptpts_1_1.png" alt="Whiteboard1" style="width:400px;height:300px;" />
                                    <figcaption align="center">Stands Left Kept Points</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/keptpts_1_2.png" alt="Whiteboard2" style="width:400px;height:300px;"/>
                                    <figcaption align="center">Stands Right Kept Points</figcaption> 
                                </td>
                            </tr>
                        </table>
                    
                    
                    </p>

                    <h2>4-point RANSAC Loop</h2>
                    <p>
                        Here, I compute a homography matrix mapping points from a source image to the coordinate system of another image using the 4-point RANSAC method. The four steps of the RANSAC loop are as follows: 1. Select 4 random indices and use those to select 4 kept interest points in the first image and 4 kept interest points in the second image. 2. Compute an exact homography H using the 8 aforementioned points. 3. Compute inliers where \(\text{dist}(p_i', Hp_i) < \epsilon\), where I define \(\epsilon=1\), and 4. Keep the set of inliers largest across all iterations so far. Once a set of inliers is obtained, compute H using those inliers. I found that using 1000 iterations produced sastisfactory homography matrices.
                    </p>
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/final_inliers_1_1.png" alt="Whiteboard1" style="width:400px;height:300px;" />
                                    <figcaption align="center">Stands Left Final Inliers</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/final_inliers_1_2.png" alt="Whiteboard2" style="width:400px;height:300px;"/>
                                    <figcaption align="center">Stands Right Final Inliers</figcaption> 
                                </td>
                            </tr>
                        </table>
                    </p>

                    <h2>Comparisons of Mosaics</h2>
                    <p>
                        Having the H matrix from the RANSAC loop, I can now create the mosaic using image warping and mosaic stitching methods similar to part A. Here's a comparison between the Stands mosaic from manual selection of feature points and the Stands mosaic from autostitching:
                    </p>
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/blended_1.png" alt="Whiteboard1" style="width:600px;height:342px;" />
                                    <figcaption align="center">Stands Mosaic(Manual)</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/blended_1_ramsac.png" alt="Whiteboard2" style="width:600px;height:358px;"/>
                                    <figcaption align="center">Stands Mosaic(Autostitching)</figcaption> 
                                </td>
                            </tr>
                        </table>
                        
                        <p>Notice that autostitching allows for the "Center for Connected Learning" stand text to be readable and nonblurry, while the manual version has some blurry "Center for Connected Learning" stand text.</p>
                        <table align="center">
                            <tr>
                                <td>
                                    <img src="images_4/StandsManual2.png" alt="Whiteboard1" style="width:400px;height:389px;"/>
                                    <figcaption align="center">Stands Mosaic(Manual)</figcaption> 
                                </td>
                                <td>
                                    <img src="images_4/StandsAutostitching2.png" alt="Whiteboard2" style="width:400px;height:415px;"/>
                                    <figcaption align="center">Stands Mosaic(Autostitching)</figcaption> 
                                </td>
                            </tr>
                        </table>
                    
                    <p>Here is another example:</p>

                    <table align="center">
                        <tr>
                            <td>
                                <img src="images_4/blended_2.png" alt="Whiteboard1" style="width:500px;height:356px;" />
                                <figcaption align="center">Whiteboard Mosaic(Manual)</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/blended_2_ramsac.png" alt="Whiteboard2" style="width:600px;height:438px;"/>
                                <figcaption align="center">Whiteboard Mosaic(Autostitching)</figcaption> 
                            </td>
                        </tr>
                    </table>
                    <p>For the whiteboard, autostitching method produces clearer text on the whiteboard than the manual method: </p>
                    <table align="center">
                        <tr>
                            <td>
                                <img src="images_4/WhiteboardManual.png" alt="Whiteboard1" style="width:500px;height:377px;" />
                                <figcaption align="center">Whiteboard Mosaic(Manual)</figcaption> 
                            </td>
                            <td>
                                <img src="images_4/WhiteboardAutostitching.png" alt="Whiteboard2" style="width:500px;height:319px;"/>
                                <figcaption align="center">Whiteboard Mosaic(Autostitching)</figcaption> 
                            </td>
                        </tr>
                    </table>
                    <p>Here's another example: </p>
                <table align="center">
                    <tr>
                        <td>
                            <img src="images_4/blended_3.png" alt="Whiteboard1" style="width:600px;height:382px;" />
                            <figcaption align="center">Door Mosaic(Manual)</figcaption> 
                        </td>
                        <td>
                            <img src="images_4/blended_3_ramsac.png" alt="Whiteboard2" style="width:600px;height:389px;"/>
                            <figcaption align="center">Door Mosaic(Autostitching)</figcaption> 
                        </td>
                    </tr>
                </table>

                

            <p>And finally, here is an example of a comparison between 2 mosaics where 3 images were used to create each of the mosaics. Vendor: </p>            <!-- </p> -->
            <table align="center">
                <tr>
                    <td>
                        <img src="images_4/blended_4.png" alt="Whiteboard1" style="width:600px;height:326px;"/>
                        <figcaption align="center">Vendor Mosaic(Manual)</figcaption> 
                    </td>
                    <td>
                        <img src="images_4/blended_4_ramsac.png" alt="Whiteboard2" style="width:600px;height:323x;"/>
                        <figcaption align="center">Vendor Mosaic(Autostitching)</figcaption> 
                    </td>
                </tr>
            </table>
            <p>Thus I've produced 4 example mosaics through autostitching and manual selection of feature points.</p>
            <h3>What I Learned</h3>
            <p>
                I thought that the coolest thing I learned when doing this project part is the math/algorithms involved with the interest points, including computing nearest neighbors and the minimum suppression radius. I also liked understanding the RAMSAC loop and understanding how the inliers are programmatically selected to serve as correspondence points for the images that are involved in the homography computation. 
            </p>

            <h3>Acknowledgements</h3>
            <ul>
                <li>
                    <a href="https://inst.eecs.berkeley.edu/~cs194-26/fa21/hw/proj4/partB.html">CS194-26 Project 4B Description</a> 
                </li>
                <li>
                    I've taken my own photographs for the mosaic using iPhone camera. The images are shown above in the website, and also are included in my submission. 
                </li>
            </ul>



            </div>


            

        </div>

    </div>

</body>


</html>
